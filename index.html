<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MCQ Quiz Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: slideDown 0.8s ease;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .content {
            padding: 40px;
        }

        .form-section {
            display: block;
        }

        .quiz-section, .results-section {
            display: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question-number {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .option {
            margin-bottom: 12px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e6ed;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .option.correct {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .option.wrong {
            border-color: #e74c3c;
            background: #ffeaa7;
        }

        .score-display {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .explanation h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .score-display h2 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .score-display p {
            font-size: 1.3em;
        }

        .error {
            color: #e74c3c;
            background: #ffe6e6;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ffc0cb;
        }

        .api-key-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .api-key-section h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-key-section p {
            color: #856404;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† AI MCQ Quiz Generator</h1>
            <p>Generate custom multiple choice quizzes with AI</p>
        </div>

        <div class="content">


            <!-- Form Section -->
            <div class="form-section">
                <div class="form-group">
                    <label for="subject">üìö Subject</label>
                    <input type="text" id="subject" placeholder="e.g., Mathematics, Physics, History" required>
                </div>

                <div class="form-group">
                    <label for="topic">üìù Topic</label>
                    <input type="text" id="topic" placeholder="e.g., Matrices, Newton's Laws, World War II" required>
                </div>

                <div class="form-group">
                    <label for="difficulty">‚ö° Difficulty Level</label>
                    <select id="difficulty" required>
                        <option value="">Select Difficulty</option>
                        <option value="Easy">Easy</option>
                        <option value="Medium">Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="numQuestions">üî¢ Number of Questions</label>
                    <select id="numQuestions" required>
                        <option value="">Select Number</option>
                        <option value="3">3 Questions</option>
                        <option value="5">5 Questions</option>
                        <option value="6">6 Questions</option>
                        <option value="8">8 Questions</option>
                        <option value="10">10 Questions</option>
                    </select>
                </div>

                <button class="btn" onclick="generateQuiz()">üöÄ Generate Quiz</button>
            </div>

            <!-- Loading Section -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Generating your quiz with AI magic... ‚ú®</p>
            </div>

            <!-- Error Display -->
            <div id="error" class="error" style="display: none;"></div>

            <!-- Quiz Section -->
            <div class="quiz-section" id="quizSection">
                <div id="quizContainer"></div>
                <button class="btn" onclick="submitQuiz()" id="submitBtn">üìä Submit Quiz</button>
                <button class="btn" onclick="resetQuiz()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); margin-top: 10px;">üîÑ Generate New Quiz</button>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <div id="scoreDisplay"></div>
                <div id="reviewContainer"></div>
                <button class="btn" onclick="resetQuiz()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üîÑ Generate New Quiz</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuiz = [];
        let userAnswers = [];

        async function generateQuiz() {
            // API key for Google AI Studio
            const apiKey = "AIzaSyBrmMtzM8Fs1r-F_YNS5RE80B6yspFgcCA";
            
            const subject = document.getElementById('subject').value.trim();
            const topic = document.getElementById('topic').value.trim();
            const difficulty = document.getElementById('difficulty').value;
            const numQuestions = document.getElementById('numQuestions').value;

            // Validation
            if (!subject || !topic || !difficulty || !numQuestions) {
                showError('Please fill in all fields');
                return;
            }

            // Show loading
            document.querySelector('.form-section').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            hideError();

            try {
                // Create better prompt for Gemini with explanations
                const prompt = `Create exactly ${numQuestions} multiple choice questions about "${topic}" in ${subject} at ${difficulty} level.

Return ONLY a JSON array in this exact format:
[
  {
    "question": "What is the determinant of a 2x2 matrix [[a,b],[c,d]]?",
    "options": ["ad-bc", "ac-bd", "ab-cd", "ad+bc"],
    "correctAnswer": 0,
    "explanation": "The determinant of a 2x2 matrix [[a,b],[c,d]] is calculated as ad-bc. This is a fundamental formula in linear algebra used to determine if a matrix is invertible."
  }
]

Rules:
- Return only valid JSON, no extra text
- correctAnswer is index 0-3 
- Add detailed explanation for why the correct answer is right
- Make ${numQuestions} questions exactly
- ${difficulty} difficulty level
- Topic: ${topic}
- Subject: ${subject}
- Explanations should be educational and clear`;

                console.log('Sending prompt:', prompt);

                // Call Gemini API with better error handling
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048,
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH", 
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('API Response:', errorData);
                    
                    if (response.status === 403) {
                        throw new Error('API key invalid or region not supported. Check your Google AI Studio settings.');
                    } else if (response.status === 429) {
                        throw new Error('Rate limit exceeded. Please try again after a few minutes.');
                    } else if (response.status === 500) {
                        throw new Error('Internal server error. Please try again.');
                    } else {
                        throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                    }
                }

                const data = await response.json();
                console.log('API Response:', data);
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid response format from API');
                }

                let generatedText = data.candidates[0].content.parts[0].text;
                console.log('Raw response:', generatedText);
                
                // Clean the response text
                generatedText = generatedText.trim();
                
                // Remove any markdown formatting
                generatedText = generatedText.replace(/```json/g, '').replace(/```/g, '').trim();
                
                // Try multiple JSON extraction methods
                let parsedQuiz = null;
                
                // Method 1: Direct parse if it starts with [
                if (generatedText.startsWith('[')) {
                    try {
                        parsedQuiz = JSON.parse(generatedText);
                    } catch (e) {
                        console.log('Method 1 failed:', e);
                    }
                }
                
                // Method 2: Find JSON array pattern
                if (!parsedQuiz) {
                    const jsonArrayMatch = generatedText.match(/\[[\s\S]*?\](?=\s*$)/);
                    if (jsonArrayMatch) {
                        try {
                            parsedQuiz = JSON.parse(jsonArrayMatch[0]);
                        } catch (e) {
                            console.log('Method 2 failed:', e);
                        }
                    }
                }
                
                // Method 3: Extract questions manually and create proper format
                if (!parsedQuiz) {
                    try {
                        // Try to find question patterns with explanations
                        const questionPattern = /"question"\s*:\s*"([^"]+)"/g;
                        const optionsPattern = /"options"\s*:\s*\[([^\]]+)\]/g;
                        const answerPattern = /"correctAnswer"\s*:\s*(\d+)/g;
                        const explanationPattern = /"explanation"\s*:\s*"([^"]+)"/g;
                        
                        const questions = [...generatedText.matchAll(questionPattern)];
                        const optionsMatches = [...generatedText.matchAll(optionsPattern)];
                        const answers = [...generatedText.matchAll(answerPattern)];
                        const explanations = [...generatedText.matchAll(explanationPattern)];
                        
                        if (questions.length > 0 && optionsMatches.length > 0 && answers.length > 0) {
                            parsedQuiz = [];
                            for (let i = 0; i < Math.min(questions.length, optionsMatches.length, answers.length); i++) {
                                const options = optionsMatches[i][1].split(',').map(opt => opt.trim().replace(/"/g, ''));
                                parsedQuiz.push({
                                    question: questions[i][1],
                                    options: options,
                                    correctAnswer: parseInt(answers[i][1]),
                                    explanation: explanations[i] ? explanations[i][1] : "Explanation not available for this question."
                                });
                            }
                        }
                    } catch (e) {
                        console.log('Method 3 failed:', e);
                    }
                }
                
                // Method 4: Create fallback quiz if all methods fail
                if (!parsedQuiz || !Array.isArray(parsedQuiz) || parsedQuiz.length === 0) {
                    console.log('All parsing methods failed, creating fallback quiz');
                    parsedQuiz = createFallbackQuiz(subject, topic, difficulty, numQuestions);
                }
                
                currentQuiz = parsedQuiz;
                
                if (!Array.isArray(currentQuiz) || currentQuiz.length === 0) {
                    throw new Error('Invalid quiz format received');
                }

                displayQuiz();

            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to generate quiz: ${error.message}`);
                document.querySelector('.form-section').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';
            userAnswers = new Array(currentQuiz.length).fill(null);

            currentQuiz.forEach((question, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                
                questionDiv.innerHTML = `
                    <div class="question-number">Question ${questionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, optionIndex) => `
                            <div class="option" onclick="selectAnswer(${questionIndex}, ${optionIndex})">
                                <input type="radio" name="question${questionIndex}" value="${optionIndex}" id="q${questionIndex}o${optionIndex}">
                                <label for="q${questionIndex}o${optionIndex}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });

            document.getElementById('quizSection').style.display = 'block';
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            
            // Update radio button
            const radio = document.getElementById(`q${questionIndex}o${optionIndex}`);
            radio.checked = true;
            
            // Visual feedback
            const allOptions = document.querySelectorAll(`input[name="question${questionIndex}"]`).forEach(input => {
                input.parentElement.style.background = 'white';
                input.parentElement.style.borderColor = '#e0e6ed';
            });
            
            const selectedOption = document.getElementById(`q${questionIndex}o${optionIndex}`).parentElement;
            selectedOption.style.background = '#f0f8ff';
            selectedOption.style.borderColor = '#3498db';
        }

        function submitQuiz() {
            // Check if all questions are answered
            if (userAnswers.includes(null)) {
                showError('Please answer all questions before submitting');
                return;
            }

            let correctAnswers = 0;
            
            currentQuiz.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    correctAnswers++;
                }
            });

            const percentage = Math.round((correctAnswers / currentQuiz.length) * 100);
            
            displayResults(correctAnswers, percentage);
            highlightAnswers();
        }

        function displayResults(correctAnswers, percentage) {
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            let message = '';
            let bgColor = '';
            
            if (percentage >= 80) {
                message = 'Excellent! üèÜ';
                bgColor = 'linear-gradient(135deg, #00b894, #00a085)';
            } else if (percentage >= 60) {
                message = 'Good Job! üëç';
                bgColor = 'linear-gradient(135deg, #fdcb6e, #e17055)';
            } else {
                message = 'Keep Practicing! üí™';
                bgColor = 'linear-gradient(135deg, #fd79a8, #e84393)';
            }

            scoreDisplay.innerHTML = `
                <div class="score-display" style="background: ${bgColor};">
                    <h2>${percentage}%</h2>
                    <p>${message}</p>
                    <p>You got ${correctAnswers} out of ${currentQuiz.length} questions correct</p>
                </div>
            `;

            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
        }

        function highlightAnswers() {
            const reviewContainer = document.getElementById('reviewContainer');
            reviewContainer.innerHTML = '<h3 style="margin-bottom: 20px; color: #2c3e50;">üìã Quiz Review</h3>';

            currentQuiz.forEach((question, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                
                const isCorrect = userAnswers[questionIndex] === question.correctAnswer;
                
                questionDiv.innerHTML = `
                    <div class="question-number">Question ${questionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, optionIndex) => {
                            let className = 'option';
                            if (optionIndex === question.correctAnswer) {
                                className += ' correct';
                            } else if (optionIndex === userAnswers[questionIndex] && !isCorrect) {
                                className += ' wrong';
                            }
                            
                            return `
                                <div class="${className}">
                                    ${optionIndex === question.correctAnswer ? '‚úÖ' : optionIndex === userAnswers[questionIndex] && !isCorrect ? '‚ùå' : '‚ö™'} 
                                    ${option}
                                    ${optionIndex === question.correctAnswer ? ' (Correct Answer)' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${question.explanation ? `
                        <div class="explanation">
                            <h4>üí° Explanation:</h4>
                            <div class="explanation-text">${question.explanation}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(questionDiv);
            });
        }

        function resetQuiz() {
            document.querySelector('.form-section').style.display = 'block';
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            hideError();
            
            currentQuiz = [];
            userAnswers = [];
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Fallback quiz generator
        function createFallbackQuiz(subject, topic, difficulty, numQuestions) {
            const sampleQuizzes = {
                Mathematics: {
                    Matrices: [
                        {
                            question: "What is the determinant of a 2√ó2 matrix [[a,b],[c,d]]?",
                            options: ["ad - bc", "ac - bd", "ab - cd", "ad + bc"],
                            correctAnswer: 0,
                            explanation: "The determinant of a 2√ó2 matrix [[a,b],[c,d]] is calculated using the formula ad - bc. This value determines if the matrix is invertible (non-zero determinant) or singular (zero determinant)."
                        },
                        {
                            question: "What is the identity matrix for 2√ó2 matrices?",
                            options: ["[[1,0],[0,1]]", "[[0,1],[1,0]]", "[[1,1],[1,1]]", "[[0,0],[0,0]]"],
                            correctAnswer: 0,
                            explanation: "The 2√ó2 identity matrix is [[1,0],[0,1]]. When any matrix is multiplied by the identity matrix, it remains unchanged. The identity matrix has 1s on the main diagonal and 0s elsewhere."
                        },
                        {
                            question: "Matrix multiplication is:",
                            options: ["Always commutative", "Never commutative", "Sometimes commutative", "Only commutative for square matrices"],
                            correctAnswer: 2,
                            explanation: "Matrix multiplication is sometimes commutative. While generally AB ‚â† BA, there are special cases where matrices do commute, such as when multiplying by the identity matrix or certain diagonal matrices."
                        }
                    ]
                },
                Physics: {
                    Waves: [
                        {
                            question: "What is the unit of frequency?",
                            options: ["Hertz", "Meter", "Second", "Joule"],
                            correctAnswer: 0,
                            explanation: "Hertz (Hz) is the unit of frequency, representing the number of cycles per second. It's named after Heinrich Hertz and is equivalent to one cycle per second or s‚Åª¬π."
                        },
                        {
                            question: "The speed of light in vacuum is:",
                            options: ["3√ó10‚Å∏ m/s", "3√ó10‚Å∂ m/s", "3√ó10¬π‚Å∞ m/s", "3√ó10‚Åµ m/s"],
                            correctAnswer: 0,
                            explanation: "The speed of light in vacuum is approximately 3√ó10‚Å∏ m/s (299,792,458 m/s to be exact). This is a fundamental physical constant denoted by 'c' and represents the maximum speed at which information can travel."
                        }
                    ]
                }
            };

            let fallbackQuiz = [];
            
            if (sampleQuizzes[subject] && sampleQuizzes[subject][topic]) {
                fallbackQuiz = sampleQuizzes[subject][topic].slice(0, parseInt(numQuestions));
            } else {
                // Generic fallback
                for (let i = 0; i < parseInt(numQuestions); i++) {
                    fallbackQuiz.push({
                        question: `Sample ${difficulty} question ${i + 1} about ${topic} in ${subject}?`,
                        options: ["Option A", "Option B", "Option C", "Option D"],
                        correctAnswer: 0,
                        explanation: `This is a sample explanation for why Option A is correct in the context of ${topic} in ${subject}. In a real quiz, this would contain detailed reasoning.`
                    });
                }
            }
            
            return fallbackQuiz;
        }
    </script>
</body>
</html>